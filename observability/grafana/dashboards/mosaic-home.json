{
  "uid": "sirios-mosaic-home",
  "title": "Sirios Mosaic — Home",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "30s",
  "time": { "from": "now-6h", "to": "now" },
  "panels": [
    {
      "type": "stat",
      "title": "App UP",
      "gridPos": { "x": 0, "y": 0, "w": 4, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "PROM" },
      "targets": [{ "expr": "mosaic_app_up" }],
      "fieldConfig": {
        "defaults": { "unit": "none", "thresholds": { "mode": "absolute", "steps": [{"color":"red","value":0},{"color":"green","value":1}] } }
      },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "none" }
    },
    {
      "type": "stat",
      "title": "Requisições /ask (5m)",
      "gridPos": { "x": 4, "y": 0, "w": 4, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "PROM" },
      "targets": [{ "expr": "sum(increase(mosaic_api_latency_ms_count{endpoint=\"/ask\"}[5m]))" }],
      "fieldConfig": { "defaults": { "unit": "short", "decimals": 0 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "type": "stat",
      "title": "Erro % (/ask, 5m)",
      "gridPos": { "x": 8, "y": 0, "w": 4, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "PROM" },
      "targets": [
        { "expr": "100 * ( sum(increase(mosaic_api_errors_total{endpoint=\"/ask\"}[5m])) / clamp_min(sum(increase(mosaic_api_latency_ms_count{endpoint=\"/ask\"}[5m])),1) )" }
      ],
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 2 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "type": "stat",
      "title": "P95 /ask (5m)",
      "gridPos": { "x": 12, "y": 0, "w": 4, "h": 4 },
      "datasource": { "type": "prometheus", "uid": "PROM" },
      "targets": [
        { "expr": "histogram_quantile(0.95, sum by (le) (rate(mosaic_api_latency_ms_bucket{endpoint=\"/ask\"}[5m])))" }
      ],
      "fieldConfig": { "defaults": { "unit": "ms", "decimals": 0 } },
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "type": "timeseries",
      "title": "Tráfego /ask",
      "gridPos": { "x": 0, "y": 4, "w": 16, "h": 8 },
      "datasource": { "type": "prometheus", "uid": "PROM" },
      "targets": [
        { "expr": "sum by (endpoint) (increase(mosaic_api_latency_ms_count{endpoint=\"/ask\"}[1m]))", "legendFormat": "ask/min" }
      ],
      "options": { "legend": { "showLegend": true }, "tooltip": { "mode": "single" } }
    },
    {
      "type": "logs",
      "title": "Logs (Promtail/Loki)",
      "gridPos": { "x": 0, "y": 12, "w": 16, "h": 10 },
      "datasource": { "type": "loki", "uid": "LOKI" },
      "targets": [
        { "expr": "{job=\"mosaic\"}", "refId": "A" }
      ],
      "options": { "showLabels": true, "wrapLogMessage": true }
    }
  ],
  "annotations": { "list": [] }
}
